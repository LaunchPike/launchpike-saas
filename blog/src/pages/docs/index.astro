---
import { getCollection, type CollectionEntry } from "astro:content";
export const prerender = true;

let docs: CollectionEntry<'docs'>[] = [];
try {
  docs = (await getCollection('docs')).filter((d) => !d.data?.draft);
  docs.sort((a, b) => {
    const ga = a.data?.group ?? 'General';
    const gb = b.data?.group ?? 'General';
    if (ga !== gb) return ga.localeCompare(gb);
    return (a.data?.order ?? 0) - (b.data?.order ?? 0);
  });
} catch (_) {
  docs = [];
}

const groups = docs.reduce((acc, e) => {
  const g = e.data?.group ?? 'General';
  (acc[g] ||= []).push(e);
  return acc;
}, {} as Record<string, CollectionEntry<'docs'>[]>);
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Docs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial;}
      .wrap { max-width: 900px; margin: 0 auto; padding: 32px 20px; }
      h1 { font-size: 2rem; font-weight: 800; margin: 0 0 1rem; }
      h2 { font-size: 1rem; margin: 1.5rem 0 .5rem; color:#6b7280; text-transform: uppercase; letter-spacing: .06em; }
      ul { list-style: none; padding: 0; margin: .25rem 0 1rem; }
      a  { display: inline-block; padding: 8px 10px; border-radius: 8px; text-decoration: none; color:#111827; }
      a:hover { background:#f3f4f6; }
      .empty { padding: 12px; background:#fff7ed; border:1px solid #fed7aa; border-radius:10px; }
    </style>
  </head>
  <body>
    <main class="wrap">
      <h1>Documentation</h1>

      {Object.keys(groups).length === 0 ? (
        <div class="empty">
          No docs found. Create files in <code>src/content/docs/</code>
          (e.g. <code>introduction.md</code>) and rebuild.
        </div>
      ) : (
        Object.entries(groups).map(([group, items]) => (
          <>
            <h2>{group}</h2>
            <ul>
              {items.map((e) => (
                <li>
                  <a href={`/docs/${e.slug}/`}>{e.data.title}</a>
                </li>
              ))}
            </ul>
          </>
        ))
      )}
    </main>
  </body>
</html>
